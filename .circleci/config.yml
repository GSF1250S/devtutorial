# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/configuration-reference/#jobs
jobs:
  validate-content-with-AppInspect:
# Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
# See: https://circleci.com/docs/configuration-reference/#executor-job
    docker:
      - image: cimg/python:3.7
#    working_directory: ~/repo
    steps:
      - checkout
#      - run:
#          name: Checkout repository
#          command: |
#            if [ "${CIRCLE_BRANCH}" == "" ]; then
#                git clone https://${GITHUB_TOKEN}@github.com/GSF1250S/devtutorial.git
#            else
#                git clone --branch ${CIRCLE_BRANCH} https://${GITHUB_TOKEN}@github.com/GSF1250S/devtutorial.git
#            fi
      - run:
          name: Install system packages
          command: |
            sudo apt update -qq
            sudo apt install -y python3-pip
            sudo pip install --upgrade pip setuptools
            sudo pip install splunk-appinspect
      - run:
          name: Run AppInspect
          command: |
            splunk-appinspect inspect . --included-tags=cloud
#            rm -rf /.circleci
#            rm -rf /.git
#            rm -rf /.gitignore          
#            rm -rf devtutorial/.git
#            rm -rf devtutorial/.circleci
#            rm -rf devtutorial/.gitignore
#            ls
#            splunk-appinspect inspect ./devtutorial --included-tags=cloud 

# Orchestrate jobs using workflows
# See: https://circleci.com/docs/configuration-reference/#workflows
workflows:
  validate-content-workflow:
    jobs:
      - validate-content-with-AppInspect
